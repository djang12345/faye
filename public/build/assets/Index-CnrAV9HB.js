import{r as g,n as j,p as Z,j as tt,w as st,o as i,b as s,c as d,s as $,h as v,t as l,e as c,f as R,F as B,a as et,k as S,d as f,l as y,x as ot,g as T}from"./app-DSbO2B8p.js";import{A as nt}from"./AuthenticatedLayout-C2NJg4lw.js";import{P as lt}from"./Pagination-DBAlykLF.js";import{_ as it}from"./_plugin-vue_export-helper-DlAUqK2U.js";const dt={class:"container-fluid p-2"},at={class:"row g-4"},rt={key:0,class:"col-md-12"},ct={class:"card p-3 shadow-sm border-0 bg-light"},ut={class:"d-flex align-items-center justify-content-between"},mt={class:"d-flex gap-2"},vt=["disabled"],bt=["disabled"],gt={key:0,class:"mt-3 p-3 bg-white rounded"},ft={class:"row"},kt={class:"col-md-4"},yt={key:0,class:"col-md-4"},pt={key:1,class:"col-md-4"},ht={class:"col-md-3"},_t={class:"card p-3 shadow-sm border-0 bg-light"},wt={class:"d-flex align-items-center"},xt={class:"ms-3"},Ct={class:"mb-0"},At={class:"mb-0"},St={class:"col-md-3"},Tt={class:"card p-3 shadow-sm border-0 bg-light"},Mt={class:"d-flex align-items-center"},Dt={class:"ms-3"},$t={class:"mb-0"},Et={class:"mb-0"},It={class:"col-md-3"},Nt={class:"card p-3 shadow-sm border-0 bg-light"},jt={class:"d-flex align-items-center"},Ot={class:"ms-3"},Pt={class:"mb-0"},Ut={class:"mb-0"},Ft={class:"col-md-3"},Rt={class:"card p-3 shadow-sm border-0 bg-light"},Bt={class:"d-flex align-items-center"},Ht={class:"ms-3"},Lt={class:"mb-0"},Vt={class:"mb-0"},qt={class:"col-md-12"},Yt={class:"card shadow-sm border-0"},zt={class:"card-header bg-white"},Gt={class:"d-flex justify-content-between align-items-center"},Kt={class:"mb-0"},Wt={class:"card-body p-0"},Xt={class:"table-responsive"},Jt={class:"table table-hover mb-0"},Qt={class:"table-light"},Zt={key:0,class:"border-0"},ts={class:"border-0"},ss={key:0},es=["onClick"],os=["onClick"],ns=["onClick"],ls={class:"card-footer bg-white"},is={class:"modal-content"},ds={class:"modal-header"},as={key:0,class:"modal-body"},rs={class:"row"},cs={class:"col-md-6"},us={key:0,class:"col-md-6"},ms={class:"row mt-3"},vs={class:"col-md-6"},bs={class:"col-md-6"},gs={class:"row mt-3"},fs={class:"col-md-6"},ks={class:"col-md-6"},ys={key:0,class:"row mt-3"},ps={class:"col-12"},hs={class:"modal-footer"},_s={class:"modal-content"},ws={class:"modal-header"},xs={key:0,class:"modal-body"},Cs={class:"mb-3"},As={class:"mb-3"},Ss={class:"mb-3"},Ts={class:"mb-3"},Ms={class:"d-flex justify-content-end gap-2"},Ds={class:"modal-content"},$s={class:"modal-header"},Es={class:"modal-body"},Is={class:"mb-3"},Ns=["value"],js={class:"mb-3"},Os={class:"mb-3"},Ps={class:"mb-3"},Us={class:"mb-3"},Fs={class:"d-flex justify-content-end gap-2"},Rs={__name:"Index",props:{attendances:Object,isAdmin:Boolean,employees:Array},setup(a){const p=a,h=g(null),M=g(!0),D=g(!1),u=g(null),m=g(null),w=g(!1),A=g(!1),x=g(!1),r=g({user_id:"",date:new Date().toISOString().split("T")[0],clock_in:"",clock_out:"",notes:""}),H=j(()=>p.attendances.data.filter(o=>o.clock_in&&o.clock_out).length),L=j(()=>p.attendances.data.filter(o=>o.clock_in&&!o.clock_out).length),V=j(()=>{const o=new Date().getMonth(),t=new Date().getFullYear();return p.attendances.data.filter(n=>{const e=new Date(n.date);return e.getMonth()===o&&e.getFullYear()===t}).length});Z(()=>{p.isAdmin||E()});const E=async()=>{var o;try{const t=p.isAdmin?"/admin/attendance/today":"/attendance/today",n=(o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"),e=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",...n&&{"X-CSRF-TOKEN":n}},credentials:"same-origin"});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const b=await e.json();h.value=b.attendance,M.value=b.canClockIn,D.value=b.canClockOut}catch(t){console.error("Error loading today's attendance:",t),M.value=!0,D.value=!1}},q=()=>{const o=p.isAdmin?"/admin/attendance/clock-in":"/attendance/clock-in";T.post(o,{},{onSuccess:()=>{E()}})},Y=()=>{const o=p.isAdmin?"/admin/attendance/clock-out":"/attendance/clock-out";T.post(o,{},{onSuccess:()=>{E()},onError:t=>{console.error("Clock out error:",t)}})},z=o=>{u.value=o,A.value=!0},G=o=>{const t=n=>{if(!n)return"";if(typeof n=="string"&&n.match(/^\d{2}:\d{2}$/))return n;if(typeof n=="string"&&n.match(/^\d{2}:\d{2}:\d{2}$/))return n.substring(0,5);if(n instanceof Date)return n.toTimeString().slice(0,5);try{const e=new Date(n);if(!isNaN(e.getTime()))return e.toTimeString().slice(0,5)}catch(e){console.error("Error parsing time for edit:",n,e)}return""};m.value={...o,clock_in:t(o.clock_in),clock_out:t(o.clock_out)},x.value=!0},K=()=>{const t=window.location.pathname.includes("/admin/attendance")?`/admin/attendance/${m.value.id}`:`/attendance/${m.value.id}`;console.log("Updating attendance with route:",t),T.put(t,m.value,{onSuccess:()=>{console.log("Attendance updated successfully"),x.value=!1},onError:n=>{console.error("Error updating attendance:",n)}})},W=()=>{w.value=!0,r.value={user_id:"",date:new Date().toISOString().split("T")[0],clock_in:"",clock_out:"",notes:""}},X=()=>{if(!r.value.user_id){alert("Please select an employee.");return}if(!r.value.date){alert("Please select a date.");return}const o=window.location.pathname.includes("/admin/attendance"),t=o?"/admin/attendance":"/attendance";console.log("Creating attendance with route:",t),console.log("Is admin page:",o),console.log("Form data:",r.value),T.post(t,r.value,{onSuccess:()=>{console.log("Attendance created successfully"),w.value=!1,r.value={user_id:"",date:new Date().toISOString().split("T")[0],clock_in:"",clock_out:"",notes:""}},onError:n=>{console.error("Error creating attendance:",n)}})},J=o=>{if(confirm("Are you sure you want to delete this attendance record?")){const n=window.location.pathname.includes("/admin/attendance")?`/admin/attendance/${o.id}`:`/attendance/${o.id}`;console.log("Deleting attendance with route:",n),T.delete(n,{onSuccess:()=>{console.log("Attendance deleted successfully")},onError:e=>{console.error("Error deleting attendance:",e)}})}},I=o=>new Date(o).toLocaleDateString(),C=o=>{if(!o)return"-";if(typeof o=="string"&&o.match(/^\d{2}:\d{2}$/))return o;if(typeof o=="string"&&o.match(/^\d{2}:\d{2}:\d{2}$/))return o.substring(0,5);if(o instanceof Date)return o.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});try{const t=new Date(o);if(!isNaN(t.getTime()))return t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch(t){console.error("Error parsing time:",o,t)}return o||"-"},O=(o,t)=>{if(!o||!t)return"-";const n=F=>{if(!F)return 0;let k=F;if(typeof k=="string"&&(k.match(/^\d{2}:\d{2}:\d{2}$/)&&(k=k.substring(0,5)),k.match(/^\d{2}:\d{2}$/))){const[_,Q]=k.split(":").map(Number);return _*60+Q}try{const _=new Date(k);if(!isNaN(_.getTime()))return _.getHours()*60+_.getMinutes()}catch(_){console.error("Error parsing time for hours calculation:",k,_)}return 0},e=n(o),b=n(t);return e===0||b===0?"-":((b-e)/60).toFixed(2)+" hrs"},P=o=>o.clock_in?o.clock_out?"badge bg-success":"badge bg-warning":"badge bg-secondary",U=o=>o.clock_in?o.clock_out?"Completed":"Clocked In":"Not Clocked In";return(o,t)=>(i(),tt(nt,null,{default:st(()=>{var n;return[s("div",dt,[s("div",at,[a.isAdmin?c("",!0):(i(),d("div",rt,[s("div",ct,[s("div",ut,[t[23]||(t[23]=s("div",null,[s("h5",{class:"mb-0"},"Today's Attendance"),s("p",{class:"text-muted mb-0"},"Manage your daily attendance")],-1)),s("div",mt,[s("button",{onClick:q,disabled:!M.value,class:$(["btn btn-success",{"opacity-50":!M.value}])},t[21]||(t[21]=[s("i",{class:"bx bx-log-in me-2"},null,-1),v("Clock In ")]),10,vt),s("button",{onClick:Y,disabled:!D.value,class:$(["btn btn-danger",{"opacity-50":!D.value}])},t[22]||(t[22]=[s("i",{class:"bx bx-log-out me-2"},null,-1),v("Clock Out ")]),10,bt)])]),h.value?(i(),d("div",gt,[s("div",ft,[s("div",kt,[t[24]||(t[24]=s("strong",null,"Date:",-1)),v(" "+l(I(h.value.date)),1)]),h.value.clock_in?(i(),d("div",yt,[t[25]||(t[25]=s("strong",null,"Clock In:",-1)),v(" "+l(C(h.value.clock_in)),1)])):c("",!0),h.value.clock_out?(i(),d("div",pt,[t[26]||(t[26]=s("strong",null,"Clock Out:",-1)),v(" "+l(C(h.value.clock_out)),1)])):c("",!0)])])):c("",!0)])])),s("div",ht,[s("div",_t,[s("div",wt,[t[27]||(t[27]=s("div",{class:"bg-primary text-white rounded-circle d-flex align-items-center justify-content-center",style:{width:"60px",height:"60px"}},[s("i",{class:"bx bxs-time"})],-1)),s("div",xt,[s("h6",Ct,l(a.isAdmin?"Total Records":"My Records"),1),s("h3",At,l(a.attendances.total),1)])])])]),s("div",St,[s("div",Tt,[s("div",Mt,[t[28]||(t[28]=s("div",{class:"bg-success text-white rounded-circle d-flex align-items-center justify-content-center",style:{width:"60px",height:"60px"}},[s("i",{class:"bx bxs-check-circle"})],-1)),s("div",Dt,[s("h6",$t,l(a.isAdmin?"Completed":"My Completed"),1),s("h3",Et,l(H.value),1)])])])]),s("div",It,[s("div",Nt,[s("div",jt,[t[29]||(t[29]=s("div",{class:"bg-warning text-white rounded-circle d-flex align-items-center justify-content-center",style:{width:"60px",height:"60px"}},[s("i",{class:"bx bxs-time-five"})],-1)),s("div",Ot,[s("h6",Pt,l(a.isAdmin?"In Progress":"My In Progress"),1),s("h3",Ut,l(L.value),1)])])])]),s("div",Ft,[s("div",Rt,[s("div",Bt,[t[30]||(t[30]=s("div",{class:"bg-info text-white rounded-circle d-flex align-items-center justify-content-center",style:{width:"60px",height:"60px"}},[s("i",{class:"bx bxs-calendar"})],-1)),s("div",Ht,[s("h6",Lt,l(a.isAdmin?"This Month":"My This Month"),1),s("h3",Vt,l(V.value),1)])])])]),s("div",qt,[s("div",Yt,[s("div",zt,[s("div",Gt,[s("h5",Kt,l(a.isAdmin?"All Attendance Records":"My Attendance Records"),1),a.isAdmin?(i(),d("button",{key:0,class:"btn btn-primary btn-sm",onClick:W},t[31]||(t[31]=[s("i",{class:"bx bx-plus me-1"},null,-1),v("Add Record ")]))):c("",!0)])]),s("div",Wt,[s("div",Xt,[s("table",Jt,[s("thead",Qt,[s("tr",null,[t[32]||(t[32]=s("th",{class:"border-0"},"Date",-1)),a.isAdmin?(i(),d("th",Zt,"Employee")):c("",!0),t[33]||(t[33]=s("th",{class:"border-0"},"Clock In",-1)),t[34]||(t[34]=s("th",{class:"border-0"},"Clock Out",-1)),t[35]||(t[35]=s("th",{class:"border-0"},"Hours",-1)),t[36]||(t[36]=s("th",{class:"border-0"},"Status",-1)),s("th",ts,l(a.isAdmin?"Actions":"View"),1)])]),s("tbody",null,[(i(!0),d(B,null,R(a.attendances.data,e=>{var b;return i(),d("tr",{key:e.id},[s("td",null,l(I(e.date)),1),a.isAdmin?(i(),d("td",ss,l((b=e.user)==null?void 0:b.name),1)):c("",!0),s("td",null,l(e.clock_in?C(e.clock_in):"-"),1),s("td",null,l(e.clock_out?C(e.clock_out):"-"),1),s("td",null,l(O(e.clock_in,e.clock_out)),1),s("td",null,[s("span",{class:$(P(e))},l(U(e)),3)]),s("td",null,[s("button",{class:"btn btn-sm btn-outline-primary me-1",onClick:N=>z(e)},t[37]||(t[37]=[s("i",{class:"bx bx-show"},null,-1)]),8,es),a.isAdmin?(i(),d("button",{key:0,class:"btn btn-sm btn-outline-warning me-1",onClick:N=>G(e)},t[38]||(t[38]=[s("i",{class:"bx bx-edit"},null,-1)]),8,os)):c("",!0),a.isAdmin?(i(),d("button",{key:1,class:"btn btn-sm btn-outline-danger",onClick:N=>J(e)},t[39]||(t[39]=[s("i",{class:"bx bx-trash"},null,-1)]),8,ns)):c("",!0)])])}),128))])])])]),s("div",ls,[et(lt,{paginate:a.attendances},null,8,["paginate"])])])])])]),A.value?(i(),d("div",{key:0,class:"modal-overlay",onClick:t[3]||(t[3]=e=>A.value=!1)},[s("div",{class:"modal-container",onClick:t[2]||(t[2]=S(()=>{},["stop"]))},[s("div",is,[s("div",ds,[t[40]||(t[40]=s("h5",{class:"modal-title"},"Attendance Details",-1)),s("button",{type:"button",class:"btn-close",onClick:t[0]||(t[0]=e=>A.value=!1)})]),u.value?(i(),d("div",as,[s("div",rs,[s("div",cs,[t[41]||(t[41]=s("strong",null,"Date:",-1)),v(" "+l(I(u.value.date)),1)]),a.isAdmin?(i(),d("div",us,[t[42]||(t[42]=s("strong",null,"Employee:",-1)),v(" "+l((n=u.value.user)==null?void 0:n.name),1)])):c("",!0)]),s("div",ms,[s("div",vs,[t[43]||(t[43]=s("strong",null,"Clock In:",-1)),v(" "+l(u.value.clock_in?C(u.value.clock_in):"Not clocked in"),1)]),s("div",bs,[t[44]||(t[44]=s("strong",null,"Clock Out:",-1)),v(" "+l(u.value.clock_out?C(u.value.clock_out):"Not clocked out"),1)])]),s("div",gs,[s("div",fs,[t[45]||(t[45]=s("strong",null,"Hours Worked:",-1)),v(" "+l(O(u.value.clock_in,u.value.clock_out)),1)]),s("div",ks,[t[46]||(t[46]=s("strong",null,"Status:",-1)),s("span",{class:$(P(u.value))},l(U(u.value)),3)])]),u.value.notes?(i(),d("div",ys,[s("div",ps,[t[47]||(t[47]=s("strong",null,"Notes:",-1)),v(" "+l(u.value.notes),1)])])):c("",!0)])):c("",!0),s("div",hs,[s("button",{type:"button",class:"btn btn-secondary",onClick:t[1]||(t[1]=e=>A.value=!1)},"Close")])])])])):c("",!0),x.value?(i(),d("div",{key:1,class:"modal-overlay",onClick:t[11]||(t[11]=e=>x.value=!1)},[s("div",{class:"modal-container",onClick:t[10]||(t[10]=S(()=>{},["stop"]))},[s("div",_s,[s("div",ws,[t[48]||(t[48]=s("h5",{class:"modal-title"},"Edit Attendance",-1)),s("button",{type:"button",class:"btn-close",onClick:t[4]||(t[4]=e=>x.value=!1)})]),m.value?(i(),d("div",xs,[s("form",{onSubmit:S(K,["prevent"])},[s("div",Cs,[t[49]||(t[49]=s("label",{class:"form-label"},"Date",-1)),f(s("input",{type:"date",class:"form-control","onUpdate:modelValue":t[5]||(t[5]=e=>m.value.date=e),required:""},null,512),[[y,m.value.date]])]),s("div",As,[t[50]||(t[50]=s("label",{class:"form-label"},"Clock In",-1)),f(s("input",{type:"time",class:"form-control","onUpdate:modelValue":t[6]||(t[6]=e=>m.value.clock_in=e)},null,512),[[y,m.value.clock_in]])]),s("div",Ss,[t[51]||(t[51]=s("label",{class:"form-label"},"Clock Out",-1)),f(s("input",{type:"time",class:"form-control","onUpdate:modelValue":t[7]||(t[7]=e=>m.value.clock_out=e)},null,512),[[y,m.value.clock_out]])]),s("div",Ts,[t[52]||(t[52]=s("label",{class:"form-label"},"Notes",-1)),f(s("textarea",{class:"form-control","onUpdate:modelValue":t[8]||(t[8]=e=>m.value.notes=e),rows:"3"},null,512),[[y,m.value.notes]])]),s("div",Ms,[s("button",{type:"button",class:"btn btn-secondary",onClick:t[9]||(t[9]=e=>x.value=!1)},"Cancel"),t[53]||(t[53]=s("button",{type:"submit",class:"btn btn-primary"},"Update",-1))])],32)])):c("",!0)])])])):c("",!0),w.value&&a.isAdmin?(i(),d("div",{key:2,class:"modal-overlay",onClick:t[20]||(t[20]=e=>w.value=!1)},[s("div",{class:"modal-container",onClick:t[19]||(t[19]=S(()=>{},["stop"]))},[s("div",Ds,[s("div",$s,[t[54]||(t[54]=s("h5",{class:"modal-title"},"Add Attendance Record",-1)),s("button",{type:"button",class:"btn-close",onClick:t[12]||(t[12]=e=>w.value=!1)})]),s("div",Es,[s("form",{onSubmit:S(X,["prevent"])},[s("div",Is,[t[56]||(t[56]=s("label",{class:"form-label"},"Employee",-1)),f(s("select",{class:"form-control","onUpdate:modelValue":t[13]||(t[13]=e=>r.value.user_id=e),required:""},[t[55]||(t[55]=s("option",{value:""},"Select an employee...",-1)),(i(!0),d(B,null,R(a.employees,e=>(i(),d("option",{key:e.id,value:e.id},l(e.name)+" ("+l(e.email)+") ",9,Ns))),128))],512),[[ot,r.value.user_id]])]),s("div",js,[t[57]||(t[57]=s("label",{class:"form-label"},"Date",-1)),f(s("input",{type:"date",class:"form-control","onUpdate:modelValue":t[14]||(t[14]=e=>r.value.date=e),required:""},null,512),[[y,r.value.date]])]),s("div",Os,[t[58]||(t[58]=s("label",{class:"form-label"},"Clock In",-1)),f(s("input",{type:"time",class:"form-control","onUpdate:modelValue":t[15]||(t[15]=e=>r.value.clock_in=e)},null,512),[[y,r.value.clock_in]])]),s("div",Ps,[t[59]||(t[59]=s("label",{class:"form-label"},"Clock Out",-1)),f(s("input",{type:"time",class:"form-control","onUpdate:modelValue":t[16]||(t[16]=e=>r.value.clock_out=e)},null,512),[[y,r.value.clock_out]])]),s("div",Us,[t[60]||(t[60]=s("label",{class:"form-label"},"Notes",-1)),f(s("textarea",{class:"form-control","onUpdate:modelValue":t[17]||(t[17]=e=>r.value.notes=e),rows:"3"},null,512),[[y,r.value.notes]])]),s("div",Fs,[s("button",{type:"button",class:"btn btn-secondary",onClick:t[18]||(t[18]=e=>w.value=!1)},"Cancel"),t[61]||(t[61]=s("button",{type:"submit",class:"btn btn-primary"},"Create Record",-1))])],32)])])])])):c("",!0)]}),_:1}))}},Ys=it(Rs,[["__scopeId","data-v-e1065ce1"]]);export{Ys as default};
